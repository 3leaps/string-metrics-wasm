# Release Notes: v0.2.0 (In Progress)

**Status:** Development (Phase 0 complete, Phase 1 pending) **Target Release Date:** TBD

## Overview

v0.2.0 migrates the WASM bindings from strsim-rs to rapidfuzz-rs, aligning string-metrics-wasm with
the broader Fulmen ecosystem (pyfulmen, gofulmen, tsfulmen). This brings significant performance
improvements, ecosystem consistency, and unlocks expanded metrics in future phases.

## What's Changed

### Core Migration (Phase 0) ‚úÖ

**Replaced strsim-rs with rapidfuzz-rs 0.5:**

- All 8 core WASM functions now use rapidfuzz-rs
- 100% API compatibility maintained (no breaking changes to function signatures)
- Behavioral equivalence validated: 47/47 TypeScript tests + 46/46 validator tests passing

**Functions migrated:**

- `levenshtein` ‚Üí `rapidfuzz::distance::levenshtein::distance`
- `normalized_levenshtein` ‚Üí `rapidfuzz::distance::levenshtein::normalized_similarity`
- `osa_distance` ‚Üí `rapidfuzz::distance::osa::distance`
- `normalized_osa_similarity` ‚Üí `rapidfuzz::distance::osa::normalized_similarity`
- `damerau_levenshtein` ‚Üí `rapidfuzz::distance::damerau_levenshtein::distance`
- `normalized_damerau_levenshtein` ‚Üí
  `rapidfuzz::distance::damerau_levenshtein::normalized_similarity`
- `jaro` ‚Üí `rapidfuzz::distance::jaro::similarity`
- `jaro_winkler` ‚Üí `rapidfuzz::distance::jaro_winkler::similarity`

### Performance Impact ‚ö°

**Hot Loop Performance (sustained throughput):**

| Function                       | v0.1.0 (strsim) | v0.2.0 (rapidfuzz) | Improvement         |
| ------------------------------ | --------------- | ------------------ | ------------------- |
| levenshtein                    | 1.54M ops/sec   | 3.27M ops/sec      | **+112% faster** ‚úÖ |
| normalized_levenshtein         | 1.61M ops/sec   | 4.17M ops/sec      | **+159% faster** ‚úÖ |
| damerau_levenshtein            | 773K ops/sec    | 1.63M ops/sec      | **+111% faster** ‚úÖ |
| normalized_damerau_levenshtein | 781K ops/sec    | 1.65M ops/sec      | **+111% faster** ‚úÖ |
| jaro                           | 1.92M ops/sec   | 3.72M ops/sec      | **+94% faster** ‚úÖ  |
| jaro_winkler                   | 1.93M ops/sec   | 3.72M ops/sec      | **+93% faster** ‚úÖ  |

**Cold Init:**

- v0.1.0: 40 ¬µs average
- v0.2.0: 116 ¬µs average (+76 ¬µs, still sub-millisecond)

**Key Takeaway:** RapidFuzz delivers 1.9x‚Äì2.6x performance gains on hot paths with negligible
initialization overhead.

See [Performance Benchmarks](../benchmarks/v0.2.0-migration.md) for detailed analysis.

### Bundle Size Impact üì¶

| Metric    | v0.1.0 (strsim) | v0.2.0 (rapidfuzz) | Change            |
| --------- | --------------- | ------------------ | ----------------- |
| WASM size | 174 KB          | 225 KB             | **+51 KB (+29%)** |
| Tolerance | -               | ‚â§ 50% max          | ‚úÖ Within spec    |
| JS glue   | 11 KB           | 11 KB              | No change         |

**Status:** Bundle growth is within the agreed ‚â§50% ceiling.

### Code Improvements

- **Simplified `normalized_osa_similarity`:** Removed manual calculation, using native rapidfuzz
  function
- **Consistent API:** All functions use `.chars()` iterators uniformly
- **Version sync:** All package/Cargo versions bumped to 0.2.0-dev

## Breaking Changes

### Semantic Version Bump

**v0.2.0 represents a breaking change** due to the underlying library swap:

1. **Numeric precision:** Minor floating-point differences may occur (~1e-10) due to different
   rounding behavior
2. **Performance characteristics:** Cold init is slightly slower, hot loops are significantly faster
3. **Dependency:** Users vendoring/auditing dependencies will see rapidfuzz-rs instead of strsim-rs

### Migration Impact

**Most users will not need to change any code.** API signatures are identical.

**If you need the exact strsim-rs behavior:**

- Pin to v0.1.0 in package.json: `"string-metrics-wasm": "0.1.0"`
- Git tag `v0.1.0` remains available for reference

## Tie-Break Policy (Unchanged)

Suggestions API continues to preserve candidate order for tied scores:

```typescript
getSuggestions('test', ['best', 'fest', 'rest']);
// ‚Üí ['best', 'fest', 'rest'] (if all score equally)
// Order matches input array, ensuring deterministic output
```

This behavior is consistent with v0.1.0 and validated by the fixture suite.

## Test Coverage

- ‚úÖ **47/47** TypeScript tests passing (100%)
- ‚úÖ **46/46** Validator fixtures passing (100%)
- ‚úÖ All quality checks passing (rustfmt, clippy, biome, prettier)
- ‚úÖ Behavioral equivalence confirmed across all metrics

## Documentation

- [Performance Benchmarks](../benchmarks/v0.2.0-migration.md) - Detailed v0.1.0 vs v0.2.0 comparison
- [User Guide: Suggestions API](../user-guide/suggestions-api.md) - Unchanged API documentation
- [Development Guide](../development.md) - Building and testing

## What's Next (Phase 1) üöÄ

Phase 1 will add expanded RapidFuzz-specific metrics:

**Planned additions:**

- Token-based scorers: `ratio`, `partial_ratio`, `token_sort_ratio`, `token_set_ratio`
- Weighted variants: `WRatio`, `QRatio`
- Process helpers: `extract`, `extractOne`
- New fixtures for token-based metrics

**Estimated bundle cost:** +30-50 KB (monitoring closely)

**Status:** Awaiting architect approval to proceed

## Known Limitations

1. **Phase 1 metrics not yet available** - Token-based scorers coming in next phase
2. **No browser optimizations yet** - Works in Node/Bun, browser support untested
3. **No streaming API** - All operations are single-shot
4. **No CI integration yet** - Planned for Phase 2 (v0.2.0 final release)

## Migration Guide

### Upgrading from v0.1.0

**No code changes required** for existing functionality:

```bash
npm install string-metrics-wasm@0.2.0
# or
bun add string-metrics-wasm@0.2.0
```

Your existing code continues to work unchanged.

### If You Need v0.1.0 Behavior

Pin to the strsim-based version:

```json
{
  "dependencies": {
    "string-metrics-wasm": "0.1.0"
  }
}
```

Or use the git tag:

```json
{
  "dependencies": {
    "string-metrics-wasm": "github:3leaps/string-metrics-wasm#v0.1.0"
  }
}
```

### Performance Expectations

**If you're migrating from v0.1.0, expect:**

- ‚úÖ 2-2.6x faster hot loop performance
- ‚ö†Ô∏è ~76 ¬µs slower cold init (negligible for most use cases)
- ‚úÖ Same API, same results, same tie-break behavior

## Rationale

### Why RapidFuzz?

1. **Ecosystem Alignment:** Matches pyfulmen/gofulmen/tsfulmen on the same library, eliminating
   semantic drift
2. **Performance:** Significantly faster (1.9x‚Äì2.6x) with SIMD optimizations
3. **Feature Expansion:** Unlocks token-based metrics and process helpers needed by Crucible
4. **Active Maintenance:** rapidfuzz is actively maintained across Python, Rust, and C++
   implementations
5. **Fixture Parity:** Validator already uses rapidfuzz-rs ‚Üí proven compatibility

### Bundle Size Trade-off

**+51 KB (+29%) is acceptable because:**

- Within the agreed ‚â§50% tolerance
- Performance gains far outweigh size cost
- Users can pin v0.1.0 if size is critical
- Future optimizations (tree-shaking, feature flags) may reduce impact

## Credits

- Built with [wasm-bindgen](https://github.com/rustwasm/wasm-bindgen)
- Metrics from [rapidfuzz-rs](https://github.com/rapidfuzz/rapidfuzz-rs) 0.5
- Inspired by Python [rapidfuzz](https://github.com/maxbachmann/RapidFuzz)
- Test fixtures compatible with [Crucible](https://github.com/fulmenhq/crucible) schema v2.0.0

## Links

- [Repository](https://github.com/3leaps/string-metrics-wasm)
- [CHANGELOG](../../CHANGELOG.md)
- [v0.1.0 Release Notes](./v0.1.0.md) - Previous stable release
- [npm Package](https://www.npmjs.com/package/string-metrics-wasm)

---

**Phase 0 Status:** ‚úÖ Complete - Migration validated, benchmarks documented **Phase 1 Status:** ‚è≥
Pending architect approval **Release Status:** üöß Development (not yet published)
