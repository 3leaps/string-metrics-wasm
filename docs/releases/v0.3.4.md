# Release Notes: v0.3.4

**Status:** Ready for Release **Release Date:** 2025-10-31

## Overview

v0.3.4 is a **quality and infrastructure release** that completes the Phase 1 fixture validation
suite, introduces comprehensive test coverage tracking, and establishes best practices documentation
for AI-assisted development. While introducing a **breaking change** to camelCase API naming, it
maintains full backward compatibility through snake_case aliases.

This release focuses on **developer experience**, **test infrastructure**, and **documentation
quality** to ensure the library remains maintainable, correct, and accessible to both human and AI
developers.

## What's New

### Test Coverage Infrastructure

Integrated comprehensive test coverage tracking with enforced quality thresholds:

- **Tool**: `@vitest/coverage-v8` for V8-based coverage analysis
- **Configuration**: `vitest.config.ts` with strict thresholds
  - Statements: 90%+ required
  - Lines: 90%+ required
  - Functions: 90%+ required
  - Branches: 70%+ required (lower due to error handling paths)
- **Current Coverage**: Exceeds all targets
  - Statements: **92.28%** ✅
  - Lines: **92.28%** ✅
  - Functions: **97.14%** ✅
  - Branches: **71.42%** ✅
- **Make Target**: `make test-coverage` for detailed HTML reports
- **npm Script**: `npm run test:coverage`

Coverage is now enforced in CI/CD and provides confidence in code quality.

```bash
make test-coverage
# Generates detailed coverage report with file-by-file breakdown
```

### AI Developer Guide (AGENTS.md)

Comprehensive guide for AI-assisted development on this project:

**Core Content:**

- **Mandatory reading list** - README.md, docs/README.md, docs/development.md
- **Session startup protocol** - Context review, environment awareness, planning
- **Operational guidelines** - Detailed DO/DO-NOT lists with project-specific requirements
- **Test requirements** - 100% pass rate, coverage standards, fixture validation
- **Git operation safety** - Push authorization, gitignore respect
- **Makefile rationale** - Why we use Make as primary task orchestrator
- **API naming conventions** - camelCase vs snake_case dual support
- **Pre-commit checklist** - Step-by-step quality gate verification
- **Commit attribution** - Proper attribution format for AI-generated commits

**Key Principles:**

- Quality and reliability over speed
- Read before write, list before create
- Use Make targets over raw commands
- 100% test pass rate (no skips without approval)
- Never push without explicit approval
- Respect the thin shim architecture

This guide ensures AI developers understand the project's architecture, constraints, and quality
standards.

### Fixture Validator Enhancements (Phase 1 Complete)

Completed Phase 1 category support in the similarity-validator, bringing all fixture tests to
passing status:

**New Categories Added:**

- ✅ `indel` - Insertion/deletion distance (rapidfuzz::distance::indel)
- ✅ `lcs_seq` - Longest Common Subsequence (rapidfuzz::distance::lcs_seq)
- ✅ `ratio` - Fuzzy ratio (rapidfuzz::fuzz::ratio)
- ✅ `unified_distance` - Unified distance API (delegates to metric-specific validators)
- ✅ `unified_score` - Unified score API (delegates to metric-specific validators)

**TypeScript-Only Categories (Appropriately Skipped):**

- ⏭️ `partial_ratio`, `token_sort_ratio`, `token_set_ratio` - Token-based fuzzy matching
- ⏭️ `extract_one`, `extract` - Process helpers

**Test Status:**

- **114 fixture tests** now passing (up from 46 in v0.3.0)
- **All categories** validated against canonical rapidfuzz-rs implementation
- **Re-enabled** fixture validation in pre-push hook
- **Zero fixture failures** across all categories

The validator remains a **thin shim** with zero custom logic - pure passthrough to rapidfuzz-rs.

### Enhanced Documentation

Significantly improved documentation for maintainers and contributors:

**docs/README.md** (New)

- Documentation hub with navigation guide
- Core concepts overview
- Links to all documentation sections
- Audience guidance (library consumers, contributors, maintainers)

**docs/development.md** (Enhanced)

- **"Fixture Validation & Canonical Source of Truth"** section
- Thin shim architecture with ASCII diagrams
- Clear explanation of validator as canonical value generator
- Table showing what gets tested where (Rust validator vs TypeScript tests)
- Why we don't test the validator (it IS the oracle)
- Fixture organization and usage

**similarity-validator/README.md** (Enhanced)

- Emphasized thin shim nature in opening
- **"Testing Philosophy"** section explaining why no tests exist
- Updated supported categories (11 core + 5 TypeScript-only)
- **"Generate Mode"** usage examples
- Code examples showing direct rapidfuzz-rs delegation

**Architecture Documentation:**

```
┌─────────────────────┐
│   rapidfuzz-rs      │  ← Canonical implementation (Rust)
│   (upstream)        │     Source of truth for all metrics
└──────────┬──────────┘
           │ (direct dependency)
           ↓
┌─────────────────────┐
│ similarity-validator│  ← Dev tool: thin wrapper
│    (Rust CLI)       │     - Generates expected values
└──────────┬──────────┘     - Validates fixtures
           │                 - NO custom logic
           ↓
┌─────────────────────┐
│   YAML fixtures     │  ← Test data with expected values
│  tests/fixtures/    │     Generated by validator
└──────────┬──────────┘
           ↓
┌─────────────────────┐
│ TypeScript Tests    │  ← Verifies our implementation
│ tests/index.test.ts │     matches rapidfuzz-rs exactly
└─────────────────────┘
```

This makes the **thin shim pattern** crystal clear to all developers.

## Breaking Changes (with Backward Compatibility)

### camelCase API Convention

All APIs now use JavaScript/TypeScript standard camelCase naming:

**Option Fields:**

- ~~`score_cutoff`~~ → `scoreCutoff`
- ~~`min_score`~~ → `minScore`
- ~~`max_suggestions`~~ → `maxSuggestions`
- ~~`normalize_preset`~~ → `normalizePreset` (also accepts `preset`)
- ~~`prefer_prefix`~~ → `preferPrefix`
- ~~`jaro_prefix_scale`~~ → `jaroPrefixScale`
- ~~`jaro_max_prefix`~~ → `jaroMaxPrefix`

**Metric Identifiers:**

- ~~`jaro_winkler`~~ → `jaroWinkler`
- ~~`damerau_levenshtein`~~ → `damerauLevenshtein`
- ~~`damerau_osa`~~ → `damerauOsa`
- ~~`damerau_unrestricted`~~ → `damerauUnrestricted`
- ~~`lcs_seq`~~ → `lcsSeq`
- ~~`partial_ratio`~~ → `partialRatio`
- ~~`token_sort_ratio`~~ → `tokenSortRatio`
- ~~`token_set_ratio`~~ → `tokenSetRatio`

**Result Fields:**

- ~~`normalized_value`~~ → `normalizedValue`
- ~~`matched_range`~~ → `matchedRange`

**✅ Backward Compatibility:**

- All snake_case variants **still accepted** as aliases
- Internal auto-conversion to camelCase
- **No migration required** for existing code
- Gradual migration path available

**Why?**

- Aligns with JavaScript/TypeScript ecosystem conventions
- Improves TypeScript developer experience
- Maintains compatibility with Fulmen/Crucible (multi-language) via snake_case aliases

**Migration Example:**

```typescript
// Old (still works)
extractOne('query', choices, { score_cutoff: 0.6, max_results: 5 });

// New (recommended)
extractOne('query', choices, { scoreCutoff: 0.6, maxResults: 5 });

// Both work identically
```

## Bug Fixes

### TypeScript Type Errors in Test Suite

Fixed all TypeScript compilation errors in the test suite:

- **Added comprehensive interfaces** for all fixture test case types
  - `DistanceTestCase`, `JaroWinklerTestCase`, `SubstringTestCase`
  - `NormalizationTestCase`, `RatioTestCase`
  - `ExtractOneTestCase`, `ExtractTestCase`
  - `UnifiedDistanceTestCase`, `UnifiedScoreTestCase`
  - `SuggestionTestCase`
- **Added type assertions** for YAML fixture data conversions
- **Fixed metric name conversions** (string to typed enum)
- **Fixed normalization preset conversions** (string to typed preset)

**Result:** Zero TypeScript errors, all 119 tests pass cleanly.

## Developer Experience Improvements

### Make Targets

- **`make test-coverage`** - View detailed coverage report with threshold enforcement
- **Fixture validation** - Re-enabled in pre-push hook (all 114 tests pass)

### Quality Gates

All quality checks passing:

- ✅ rustfmt - Rust code formatting
- ✅ clippy - Rust linting
- ✅ biome - TypeScript linting/formatting
- ✅ prettier - JSON/YAML/Markdown formatting
- ✅ tsc - TypeScript type checking
- ✅ vitest - 119 tests passing
- ✅ validator - 114 fixture tests passing

### Line Ending Normalization

- Enforced **LF line endings** across all platforms via `.gitattributes`
- Applied **rustfmt** to validator code for consistency
- Prevents line ending conflicts in cross-platform development

## Test Coverage

### Unit Tests

- **119 tests** passing (100% pass rate)
- **0 skipped** tests
- **0 failures**

### Fixture Tests

- **114 fixture tests** validated against rapidfuzz-rs
- **11 categories** covered
- **5 TypeScript-only** categories (validated by unit tests)

### Coverage Metrics

- **Statements**: 92.28% (target: 90%) ✅
- **Lines**: 92.28% (target: 90%) ✅
- **Functions**: 97.14% (target: 90%) ✅
- **Branches**: 71.42% (target: 70%) ✅

**Total Test Suite:** 233 tests (119 TypeScript + 114 fixtures)

## Bundle Size

No change from v0.3.0:

- **WASM + TypeScript**: 226 KB
- **Published package**: ~30 KB (after excluding dev tools)
- **Target**: ≤275 KB ✅

Infrastructure improvements don't impact production bundle.

## Performance

No performance regressions. All operations remain **< 1ms**:

- **WASM metrics**: 0.0003-0.0005ms per operation
- **Token-based metrics**: 0.0003-0.0017ms per operation
- **Process helpers**: 0.0008-0.001ms per operation

## Migration Guide

### For Users (Optional, Recommended)

Migrate to camelCase naming for better TypeScript experience:

```typescript
// Before (still works)
import { extract_one, token_sort_ratio, jaro_winkler } from 'string-metrics-wasm';

extractOne(query, choices, {
  score_cutoff: 0.6,
  max_results: 10,
});

// After (recommended)
import { extractOne, tokenSortRatio, jaroWinkler } from 'string-metrics-wasm';

extractOne(query, choices, {
  scoreCutoff: 0.6,
  maxResults: 10,
});
```

**Timeline:** No urgency - snake_case support is permanent.

### For Contributors

1. **Install coverage tools**: Run `make bootstrap` to install `@vitest/coverage-v8`
2. **Run coverage**: Use `make test-coverage` to verify changes
3. **Read AGENTS.md**: Review if doing AI-assisted development
4. **Use Make targets**: Prefer `make test` over `npm test`

## What's Next

### v0.3.5 or v0.4.0 Planning

- Additional fixture categories (if needed)
- Performance benchmarking suite
- CI/CD coverage reporting integration
- Potential additional metrics from rapidfuzz-rs

### Long-term

- Deno-specific optimizations
- Additional TypeScript utility functions
- Enhanced suggestion API features

## Acknowledgments

This release represents significant infrastructure work to ensure **long-term maintainability** and
**quality**:

- Comprehensive test coverage tracking
- Clear documentation for AI-assisted development
- Complete fixture validation suite
- Quality-first development practices

Special thanks to the rapidfuzz-rs team for the canonical implementation that serves as our source
of truth.

## Links

- [Changelog](../../CHANGELOG.md)
- [Documentation Hub](../README.md)
- [Development Guide](../development.md)
- [API Reference](../../README.md)
- [GitHub Repository](https://github.com/3leaps/string-metrics-wasm)

---

**Release managed by:** @3leapsdave **Build system:** Make + wasm-pack + TypeScript **Test
framework:** Vitest with coverage **Canonical source:** rapidfuzz-rs 0.5.x
